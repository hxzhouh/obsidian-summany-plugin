/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var ee=Object.defineProperty;var Ye=Object.getOwnPropertyDescriptor;var qe=Object.getOwnPropertyNames;var Ve=Object.prototype.hasOwnProperty;var Je=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports),ze=(e,n)=>{for(var t in n)ee(e,t,{get:n[t],enumerable:!0})},We=(e,n,t,s)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of qe(n))!Ve.call(e,i)&&i!==t&&ee(e,i,{get:()=>n[i],enumerable:!(s=Ye(n,i))||s.enumerable});return e};var Xe=e=>We(ee({},"__esModule",{value:!0}),e);var ve=Je(u=>{"use strict";u.SchemaType=void 0;(function(e){e.STRING="string",e.NUMBER="number",e.INTEGER="integer",e.BOOLEAN="boolean",e.ARRAY="array",e.OBJECT="object"})(u.SchemaType||(u.SchemaType={}));u.ExecutableCodeLanguage=void 0;(function(e){e.LANGUAGE_UNSPECIFIED="language_unspecified",e.PYTHON="python"})(u.ExecutableCodeLanguage||(u.ExecutableCodeLanguage={}));u.Outcome=void 0;(function(e){e.OUTCOME_UNSPECIFIED="outcome_unspecified",e.OUTCOME_OK="outcome_ok",e.OUTCOME_FAILED="outcome_failed",e.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(u.Outcome||(u.Outcome={}));var te=["user","model","function","system"];u.HarmCategory=void 0;(function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT"})(u.HarmCategory||(u.HarmCategory={}));u.HarmBlockThreshold=void 0;(function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"})(u.HarmBlockThreshold||(u.HarmBlockThreshold={}));u.HarmProbability=void 0;(function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"})(u.HarmProbability||(u.HarmProbability={}));u.BlockReason=void 0;(function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER"})(u.BlockReason||(u.BlockReason={}));u.FinishReason=void 0;(function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.OTHER="OTHER"})(u.FinishReason||(u.FinishReason={}));u.TaskType=void 0;(function(e){e.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",e.RETRIEVAL_QUERY="RETRIEVAL_QUERY",e.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",e.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",e.CLASSIFICATION="CLASSIFICATION",e.CLUSTERING="CLUSTERING"})(u.TaskType||(u.TaskType={}));u.FunctionCallingMode=void 0;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE"})(u.FunctionCallingMode||(u.FunctionCallingMode={}));u.DynamicRetrievalMode=void 0;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"})(u.DynamicRetrievalMode||(u.DynamicRetrievalMode={}));var C=class extends Error{constructor(n){super(`[GoogleGenerativeAI Error]: ${n}`)}},S=class extends C{constructor(n,t){super(n),this.response=t}},L=class extends C{constructor(n,t,s,i){super(n),this.status=t,this.statusText=s,this.errorDetails=i}},_=class extends C{};var Qe="https://generativelanguage.googleapis.com",Ze="v1beta",et="0.21.0",tt="genai-js",T;(function(e){e.GENERATE_CONTENT="generateContent",e.STREAM_GENERATE_CONTENT="streamGenerateContent",e.COUNT_TOKENS="countTokens",e.EMBED_CONTENT="embedContent",e.BATCH_EMBED_CONTENTS="batchEmbedContents"})(T||(T={}));var ne=class{constructor(n,t,s,i,o){this.model=n,this.task=t,this.apiKey=s,this.stream=i,this.requestOptions=o}toString(){var n,t;let s=((n=this.requestOptions)===null||n===void 0?void 0:n.apiVersion)||Ze,o=`${((t=this.requestOptions)===null||t===void 0?void 0:t.baseUrl)||Qe}/${s}/${this.model}:${this.task}`;return this.stream&&(o+="?alt=sse"),o}};function nt(e){let n=[];return e!=null&&e.apiClient&&n.push(e.apiClient),n.push(`${tt}/${et}`),n.join(" ")}async function st(e){var n;let t=new Headers;t.append("Content-Type","application/json"),t.append("x-goog-api-client",nt(e.requestOptions)),t.append("x-goog-api-key",e.apiKey);let s=(n=e.requestOptions)===null||n===void 0?void 0:n.customHeaders;if(s){if(!(s instanceof Headers))try{s=new Headers(s)}catch(i){throw new _(`unable to convert customHeaders value ${JSON.stringify(s)} to Headers: ${i.message}`)}for(let[i,o]of s.entries()){if(i==="x-goog-api-key")throw new _(`Cannot set reserved header name ${i}`);if(i==="x-goog-api-client")throw new _(`Header name ${i} can only be set using the apiClient field`);t.append(i,o)}}return t}async function it(e,n,t,s,i,o){let a=new ne(e,n,t,s,o);return{url:a.toString(),fetchOptions:Object.assign(Object.assign({},ct(o)),{method:"POST",headers:await st(a),body:i})}}async function k(e,n,t,s,i,o={},a=fetch){let{url:r,fetchOptions:c}=await it(e,n,t,s,i,o);return ot(r,c,a)}async function ot(e,n,t=fetch){let s;try{s=await t(e,n)}catch(i){at(i,e)}return s.ok||await rt(s,e),s}function at(e,n){let t=e;throw e instanceof L||e instanceof _||(t=new C(`Error fetching from ${n.toString()}: ${e.message}`),t.stack=e.stack),t}async function rt(e,n){let t="",s;try{let i=await e.json();t=i.error.message,i.error.details&&(t+=` ${JSON.stringify(i.error.details)}`,s=i.error.details)}catch(i){}throw new L(`Error fetching from ${n.toString()}: [${e.status} ${e.statusText}] ${t}`,e.status,e.statusText,s)}function ct(e){let n={};if((e==null?void 0:e.signal)!==void 0||(e==null?void 0:e.timeout)>=0){let t=new AbortController;(e==null?void 0:e.timeout)>=0&&setTimeout(()=>t.abort(),e.timeout),e!=null&&e.signal&&e.signal.addEventListener("abort",()=>{t.abort()}),n.signal=t.signal}return n}function ie(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),K(e.candidates[0]))throw new S(`${A(e)}`,e);return lt(e)}else if(e.promptFeedback)throw new S(`Text not available. ${A(e)}`,e);return""},e.functionCall=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),K(e.candidates[0]))throw new S(`${A(e)}`,e);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),he(e)[0]}else if(e.promptFeedback)throw new S(`Function call not available. ${A(e)}`,e)},e.functionCalls=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),K(e.candidates[0]))throw new S(`${A(e)}`,e);return he(e)}else if(e.promptFeedback)throw new S(`Function call not available. ${A(e)}`,e)},e}function lt(e){var n,t,s,i;let o=[];if(!((t=(n=e.candidates)===null||n===void 0?void 0:n[0].content)===null||t===void 0)&&t.parts)for(let a of(i=(s=e.candidates)===null||s===void 0?void 0:s[0].content)===null||i===void 0?void 0:i.parts)a.text&&o.push(a.text),a.executableCode&&o.push("\n```"+a.executableCode.language+`
`+a.executableCode.code+"\n```\n"),a.codeExecutionResult&&o.push("\n```\n"+a.codeExecutionResult.output+"\n```\n");return o.length>0?o.join(""):""}function he(e){var n,t,s,i;let o=[];if(!((t=(n=e.candidates)===null||n===void 0?void 0:n[0].content)===null||t===void 0)&&t.parts)for(let a of(i=(s=e.candidates)===null||s===void 0?void 0:s[0].content)===null||i===void 0?void 0:i.parts)a.functionCall&&o.push(a.functionCall);if(o.length>0)return o}var dt=[u.FinishReason.RECITATION,u.FinishReason.SAFETY,u.FinishReason.LANGUAGE];function K(e){return!!e.finishReason&&dt.includes(e.finishReason)}function A(e){var n,t,s;let i="";if((!e.candidates||e.candidates.length===0)&&e.promptFeedback)i+="Response was blocked",!((n=e.promptFeedback)===null||n===void 0)&&n.blockReason&&(i+=` due to ${e.promptFeedback.blockReason}`),!((t=e.promptFeedback)===null||t===void 0)&&t.blockReasonMessage&&(i+=`: ${e.promptFeedback.blockReasonMessage}`);else if(!((s=e.candidates)===null||s===void 0)&&s[0]){let o=e.candidates[0];K(o)&&(i+=`Candidate was blocked due to ${o.finishReason}`,o.finishMessage&&(i+=`: ${o.finishMessage}`))}return i}function M(e){return this instanceof M?(this.v=e,this):new M(e)}function ut(e,n,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=t.apply(e,n||[]),i,o=[];return i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i;function a(d){s[d]&&(i[d]=function(l){return new Promise(function(f,v){o.push([d,l,f,v])>1||r(d,l)})})}function r(d,l){try{c(s[d](l))}catch(f){m(o[0][3],f)}}function c(d){d.value instanceof M?Promise.resolve(d.value.v).then(h,p):m(o[0][2],d)}function h(d){r("next",d)}function p(d){r("throw",d)}function m(d,l){d(l),o.shift(),o.length&&r(o[0][0],o[0][1])}}var fe=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function ht(e){let n=e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),t=pt(n),[s,i]=t.tee();return{stream:gt(s),response:ft(i)}}async function ft(e){let n=[],t=e.getReader();for(;;){let{done:s,value:i}=await t.read();if(s)return ie(mt(n));n.push(i)}}function gt(e){return ut(this,arguments,function*(){let t=e.getReader();for(;;){let{value:s,done:i}=yield M(t.read());if(i)break;yield yield M(ie(s))}})}function pt(e){let n=e.getReader();return new ReadableStream({start(s){let i="";return o();function o(){return n.read().then(({value:a,done:r})=>{if(r){if(i.trim()){s.error(new C("Failed to parse stream"));return}s.close();return}i+=a;let c=i.match(fe),h;for(;c;){try{h=JSON.parse(c[1])}catch(p){s.error(new C(`Error parsing JSON response: "${c[1]}"`));return}s.enqueue(h),i=i.substring(c[0].length),c=i.match(fe)}return o()})}}})}function mt(e){let n=e[e.length-1],t={promptFeedback:n==null?void 0:n.promptFeedback};for(let s of e){if(s.candidates)for(let i of s.candidates){let o=i.index;if(t.candidates||(t.candidates=[]),t.candidates[o]||(t.candidates[o]={index:i.index}),t.candidates[o].citationMetadata=i.citationMetadata,t.candidates[o].groundingMetadata=i.groundingMetadata,t.candidates[o].finishReason=i.finishReason,t.candidates[o].finishMessage=i.finishMessage,t.candidates[o].safetyRatings=i.safetyRatings,i.content&&i.content.parts){t.candidates[o].content||(t.candidates[o].content={role:i.content.role||"user",parts:[]});let a={};for(let r of i.content.parts)r.text&&(a.text=r.text),r.functionCall&&(a.functionCall=r.functionCall),r.executableCode&&(a.executableCode=r.executableCode),r.codeExecutionResult&&(a.codeExecutionResult=r.codeExecutionResult),Object.keys(a).length===0&&(a.text=""),t.candidates[o].content.parts.push(a)}}s.usageMetadata&&(t.usageMetadata=s.usageMetadata)}return t}async function Ce(e,n,t,s){let i=await k(n,T.STREAM_GENERATE_CONTENT,e,!0,JSON.stringify(t),s);return ht(i)}async function Ee(e,n,t,s){let o=await(await k(n,T.GENERATE_CONTENT,e,!1,JSON.stringify(t),s)).json();return{response:ie(o)}}function ye(e){if(e!=null){if(typeof e=="string")return{role:"system",parts:[{text:e}]};if(e.text)return{role:"system",parts:[e]};if(e.parts)return e.role?e:{role:"system",parts:e.parts}}}function x(e){let n=[];if(typeof e=="string")n=[{text:e}];else for(let t of e)typeof t=="string"?n.push({text:t}):n.push(t);return Ct(n)}function Ct(e){let n={role:"user",parts:[]},t={role:"function",parts:[]},s=!1,i=!1;for(let o of e)"functionResponse"in o?(t.parts.push(o),i=!0):(n.parts.push(o),s=!0);if(s&&i)throw new C("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!s&&!i)throw new C("No content is provided for sending chat message.");return s?n:t}function Et(e,n){var t;let s={model:n==null?void 0:n.model,generationConfig:n==null?void 0:n.generationConfig,safetySettings:n==null?void 0:n.safetySettings,tools:n==null?void 0:n.tools,toolConfig:n==null?void 0:n.toolConfig,systemInstruction:n==null?void 0:n.systemInstruction,cachedContent:(t=n==null?void 0:n.cachedContent)===null||t===void 0?void 0:t.name,contents:[]},i=e.generateContentRequest!=null;if(e.contents){if(i)throw new _("CountTokensRequest must have one of contents or generateContentRequest, not both.");s.contents=e.contents}else if(i)s=Object.assign(Object.assign({},s),e.generateContentRequest);else{let o=x(e);s.contents=[o]}return{generateContentRequest:s}}function ge(e){let n;return e.contents?n=e:n={contents:[x(e)]},e.systemInstruction&&(n.systemInstruction=ye(e.systemInstruction)),n}function yt(e){return typeof e=="string"||Array.isArray(e)?{content:x(e)}:e}var pe=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],vt={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function _t(e){let n=!1;for(let t of e){let{role:s,parts:i}=t;if(!n&&s!=="user")throw new C(`First content should be with role 'user', got ${s}`);if(!te.includes(s))throw new C(`Each item should include role field. Got ${s} but valid roles are: ${JSON.stringify(te)}`);if(!Array.isArray(i))throw new C("Content should have 'parts' property with an array of Parts");if(i.length===0)throw new C("Each Content should have at least one part");let o={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(let r of i)for(let c of pe)c in r&&(o[c]+=1);let a=vt[s];for(let r of pe)if(!a.includes(r)&&o[r]>0)throw new C(`Content with role '${s}' can't contain '${r}' part`);n=!0}}var me="SILENT_ERROR",H=class{constructor(n,t,s,i={}){this.model=t,this.params=s,this._requestOptions=i,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=n,s!=null&&s.history&&(_t(s.history),this._history=s.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(n,t={}){var s,i,o,a,r,c;await this._sendPromise;let h=x(n),p={safetySettings:(s=this.params)===null||s===void 0?void 0:s.safetySettings,generationConfig:(i=this.params)===null||i===void 0?void 0:i.generationConfig,tools:(o=this.params)===null||o===void 0?void 0:o.tools,toolConfig:(a=this.params)===null||a===void 0?void 0:a.toolConfig,systemInstruction:(r=this.params)===null||r===void 0?void 0:r.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,h]},m=Object.assign(Object.assign({},this._requestOptions),t),d;return this._sendPromise=this._sendPromise.then(()=>Ee(this._apiKey,this.model,p,m)).then(l=>{var f;if(l.response.candidates&&l.response.candidates.length>0){this._history.push(h);let v=Object.assign({parts:[],role:"model"},(f=l.response.candidates)===null||f===void 0?void 0:f[0].content);this._history.push(v)}else{let v=A(l.response);v&&console.warn(`sendMessage() was unsuccessful. ${v}. Inspect response object for details.`)}d=l}),await this._sendPromise,d}async sendMessageStream(n,t={}){var s,i,o,a,r,c;await this._sendPromise;let h=x(n),p={safetySettings:(s=this.params)===null||s===void 0?void 0:s.safetySettings,generationConfig:(i=this.params)===null||i===void 0?void 0:i.generationConfig,tools:(o=this.params)===null||o===void 0?void 0:o.tools,toolConfig:(a=this.params)===null||a===void 0?void 0:a.toolConfig,systemInstruction:(r=this.params)===null||r===void 0?void 0:r.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,h]},m=Object.assign(Object.assign({},this._requestOptions),t),d=Ce(this._apiKey,this.model,p,m);return this._sendPromise=this._sendPromise.then(()=>d).catch(l=>{throw new Error(me)}).then(l=>l.response).then(l=>{if(l.candidates&&l.candidates.length>0){this._history.push(h);let f=Object.assign({},l.candidates[0].content);f.role||(f.role="model"),this._history.push(f)}else{let f=A(l);f&&console.warn(`sendMessageStream() was unsuccessful. ${f}. Inspect response object for details.`)}}).catch(l=>{l.message!==me&&console.error(l)}),d}};async function wt(e,n,t,s){return(await k(n,T.COUNT_TOKENS,e,!1,JSON.stringify(t),s)).json()}async function St(e,n,t,s){return(await k(n,T.EMBED_CONTENT,e,!1,JSON.stringify(t),s)).json()}async function At(e,n,t,s){let i=t.requests.map(a=>Object.assign(Object.assign({},a),{model:n}));return(await k(n,T.BATCH_EMBED_CONTENTS,e,!1,JSON.stringify({requests:i}),s)).json()}var D=class{constructor(n,t,s={}){this.apiKey=n,this._requestOptions=s,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=ye(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(n,t={}){var s;let i=ge(n),o=Object.assign(Object.assign({},this._requestOptions),t);return Ee(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(s=this.cachedContent)===null||s===void 0?void 0:s.name},i),o)}async generateContentStream(n,t={}){var s;let i=ge(n),o=Object.assign(Object.assign({},this._requestOptions),t);return Ce(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(s=this.cachedContent)===null||s===void 0?void 0:s.name},i),o)}startChat(n){var t;return new H(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(t=this.cachedContent)===null||t===void 0?void 0:t.name},n),this._requestOptions)}async countTokens(n,t={}){let s=Et(n,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),i=Object.assign(Object.assign({},this._requestOptions),t);return wt(this.apiKey,this.model,s,i)}async embedContent(n,t={}){let s=yt(n),i=Object.assign(Object.assign({},this._requestOptions),t);return St(this.apiKey,this.model,s,i)}async batchEmbedContents(n,t={}){let s=Object.assign(Object.assign({},this._requestOptions),t);return At(this.apiKey,this.model,n,s)}};var se=class{constructor(n){this.apiKey=n}getGenerativeModel(n,t){if(!n.model)throw new C("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new D(this.apiKey,n,t)}getGenerativeModelFromCachedContent(n,t,s){if(!n.name)throw new _("Cached content must contain a `name` field.");if(!n.model)throw new _("Cached content must contain a `model` field.");let i=["model","systemInstruction"];for(let a of i)if(t!=null&&t[a]&&n[a]&&(t==null?void 0:t[a])!==n[a]){if(a==="model"){let r=t.model.startsWith("models/")?t.model.replace("models/",""):t.model,c=n.model.startsWith("models/")?n.model.replace("models/",""):n.model;if(r===c)continue}throw new _(`Different value for "${a}" specified in modelParams (${t[a]}) and cachedContent (${n[a]})`)}let o=Object.assign(Object.assign({},t),{model:n.model,tools:n.tools,toolConfig:n.toolConfig,systemInstruction:n.systemInstruction,cachedContent:n});return new D(this.apiKey,o,s)}};u.ChatSession=H;u.GenerativeModel=D;u.GoogleGenerativeAI=se;u.GoogleGenerativeAIError=C;u.GoogleGenerativeAIFetchError=L;u.GoogleGenerativeAIRequestInputError=_;u.GoogleGenerativeAIResponseError=S;u.POSSIBLE_ROLES=te});var rn={};ze(rn,{default:()=>Z});module.exports=Xe(rn);var g=require("obsidian");var E=require("obsidian");var I=require("obsidian");async function ue(e){let{baseUrl:n,opanAiApiKey:t}=e.settings;if(!t){new I.Notice("OpenAi API Key is not set!");return}let s=n||"https://api.openai.com/";s=s+"/v1/models";try{let i=await(0,I.requestUrl)({url:s,method:"GET",headers:{Authorization:`Bearer ${t}`}});i.status===200?new I.Notice("Success! Your configuration is valid."):new I.Notice(`Request failed with status: ${i.status}`)}catch(i){console.log(i),new I.Notice(`Request failed. Error: ${i}`)}}var U=require("obsidian"),{GoogleGenerativeAI:Ot}=ve();async function _e(e){let{geminiApiKey:n}=e.settings;if(!n){new U.Notice("Gemini API Key is not set!");return}console.log(n);let s=new Ot(n).getGenerativeModel({model:"gemini-1.5-flash"}),i="Explain how AI works";try{let o=await s.generateContent(i);console.log(o),o.status===200?new U.Notice("Success! Your configuration is valid."):new U.Notice(`Request failed with status: ${o.status}`)}catch(o){console.log(o),new U.Notice(`Request failed. Error: ${o}`)}}var j=class extends E.PluginSettingTab{constructor(t,s){super(t,s);this.plugin=s}display(){let{containerEl:t}=this;t.empty(),new E.Setting(t).setName("DEV Community API Keys.(https://dev.to/settings/extensions)").setDesc((0,E.sanitizeHTMLToDom)("<b>Security warning!</b><br />This will be stored unencrypted in your obsidian plugin folder. Do not use this plugin if you do not fully understand the security implications of this.")).addText(s=>s.setPlaceholder("Enter your secret").setValue(this.plugin.settings.devToApiKey).onChange(async i=>{this.plugin.settings.devToApiKey=i,await this.plugin.saveSettings()})),new E.Setting(t).setName("LLM Provider").setDesc("Select which LLM provider to use").addDropdown(s=>s.addOptions({openai:"OpenAI",gemini:"Google Gemini",deepSeek:"DeepSeek"}).setValue(this.plugin.settings.llmType).onChange(async i=>{this.plugin.settings.llmType=i,await this.plugin.saveSettings()})),new E.Setting(t).setName("Gemini API Key").setDesc("").addText(s=>s.setPlaceholder("Gemini API Key").setPlaceholder("https://aistudio.google.com/app/apikey").setValue(this.plugin.settings.geminiApiKey).onChange(async i=>{this.plugin.settings.geminiApiKey=i,await this.plugin.saveSettings()})).addButton(s=>{s.setButtonText("Check").onClick(async()=>{await _e(this.plugin)})}),new E.Setting(t).setName("Base URL(Optional)").setDesc("For 3rd party OpenAI Format endpoints only. Leave blank for other providers").addText(s=>s.setPlaceholder("https://api.example.com/v1").setValue(this.plugin.settings.baseUrl).onChange(async i=>{this.plugin.settings.baseUrl=i,await this.plugin.saveSettings()})),new E.Setting(t).setName("API Key(Required)").setDesc("API key for the 3rd party provider").addText(s=>s.setPlaceholder("sk-xxxxxxxxxxxxxxxxxxxxxxxx").setValue(this.plugin.settings.opanAiApiKey).onChange(async i=>{this.plugin.settings.opanAiApiKey=i,await this.plugin.saveSettings()})),new E.Setting(t).setName("Models (Required)").setDesc("Comma-separated list of models, default use gpt-4o-mini").addTextArea(s=>s.setPlaceholder("model1,model2,model3").setValue(this.plugin.settings.openAiModel.join(",")).onChange(async i=>{this.plugin.settings.openAiModel=i.split(",").map(o=>o.trim()),await this.plugin.saveSettings()})),new E.Setting(t).setName("Custom Prompt(Optional)").setDesc(`Custom prompt to be used for generating summaries
 <b>Default:</b> Please summarize the following article into a paragraph of no more than 150 words, highlighting the main points and making it concise and easy to understand.`).addTextArea(s=>s.setPlaceholder("Enter your custom prompt here...").setValue(this.plugin.settings.customPrompt).onChange(async i=>{this.plugin.settings.customPrompt=i,await this.plugin.saveSettings()})),new E.Setting(t).setName("Check").setDesc("Click to validate your API key and base URL by sending a request.").addButton(s=>s.setButtonText("Check").setCta().onClick(async()=>{await ue(this.plugin)})),new E.Setting(t).setName("Site URL").setDesc("The URL of your Ghost site. Make sure to include https:// at the beginning").addText(s=>s.setPlaceholder("https://ghost.org").setValue(this.plugin.settings.ghostUrl).onChange(async i=>{this.plugin.settings.ghostUrl=i,await this.plugin.saveSettings()})),new E.Setting(t).setName("Access Token").setDesc("Your Staff Access Token or Admin API Key:").addText(s=>s.setPlaceholder("6251555c94ca6").setValue(this.plugin.settings.ghostApiKey).onChange(async i=>{this.plugin.settings.ghostApiKey=i,await this.plugin.saveSettings()})),new E.Setting(t).setHeading().setName("DeepSeek").setDesc("").addText(s=>s.setPlaceholder("DeepSeek API Key").setValue(this.plugin.settings.deepSeekApiKey).onChange(async i=>{this.plugin.settings.deepSeekApiKey=i})).addText(s=>s.setPlaceholder("DeepSeek API URL").setValue(this.plugin.settings.deepSeekApiUrl).onChange(async i=>{this.plugin.settings.deepSeekApiUrl=i})).addTextArea(s=>s.setPlaceholder("model1,model2,model3").setValue(this.plugin.settings.deepSeekModel.join(",")).onChange(async i=>{this.plugin.settings.deepSeekModel=i.split(",").map(o=>o.trim())}))}};var ce=require("obsidian");var we=require("obsidian"),B=class{constructor(n){this.config=n}async generateContent(n,t){let s=(this.config.baseUrl||"https://api.openai.com")+"/v1/chat/completions",i=await(0,we.requestUrl)({url:s,method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.apiKey}`},body:JSON.stringify({model:this.config.model||"gpt-4o-mini",messages:[{role:"system",content:n},{role:"user",content:t}]})});return console.log(i),console.log(this.config),{content:i.json.choices[0].message.content,status:i.status}}async checkConfig(){try{return await this.generateContent("test","test"),!0}catch(n){return!1}}};var Se;(function(e){e.STRING="string",e.NUMBER="number",e.INTEGER="integer",e.BOOLEAN="boolean",e.ARRAY="array",e.OBJECT="object"})(Se||(Se={}));var Ae;(function(e){e.LANGUAGE_UNSPECIFIED="language_unspecified",e.PYTHON="python"})(Ae||(Ae={}));var Oe;(function(e){e.OUTCOME_UNSPECIFIED="outcome_unspecified",e.OUTCOME_OK="outcome_ok",e.OUTCOME_FAILED="outcome_failed",e.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(Oe||(Oe={}));var Re=["user","model","function","system"],Ie;(function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT"})(Ie||(Ie={}));var Te;(function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"})(Te||(Te={}));var Ne;(function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"})(Ne||(Ne={}));var be;(function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER"})(be||(be={}));var F;(function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.OTHER="OTHER"})(F||(F={}));var Le;(function(e){e.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",e.RETRIEVAL_QUERY="RETRIEVAL_QUERY",e.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",e.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",e.CLASSIFICATION="CLASSIFICATION",e.CLUSTERING="CLUSTERING"})(Le||(Le={}));var Me;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE"})(Me||(Me={}));var xe;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"})(xe||(xe={}));var y=class extends Error{constructor(n){super(`[GoogleGenerativeAI Error]: ${n}`)}},O=class extends y{constructor(n,t){super(n),this.response=t}},q=class extends y{constructor(n,t,s,i){super(n),this.status=t,this.statusText=s,this.errorDetails=i}},w=class extends y{};var Rt="https://generativelanguage.googleapis.com",It="v1beta",Tt="0.21.0",Nt="genai-js",N;(function(e){e.GENERATE_CONTENT="generateContent",e.STREAM_GENERATE_CONTENT="streamGenerateContent",e.COUNT_TOKENS="countTokens",e.EMBED_CONTENT="embedContent",e.BATCH_EMBED_CONTENTS="batchEmbedContents"})(N||(N={}));var oe=class{constructor(n,t,s,i,o){this.model=n,this.task=t,this.apiKey=s,this.stream=i,this.requestOptions=o}toString(){var n,t;let s=((n=this.requestOptions)===null||n===void 0?void 0:n.apiVersion)||It,o=`${((t=this.requestOptions)===null||t===void 0?void 0:t.baseUrl)||Rt}/${s}/${this.model}:${this.task}`;return this.stream&&(o+="?alt=sse"),o}};function bt(e){let n=[];return e!=null&&e.apiClient&&n.push(e.apiClient),n.push(`${Nt}/${Tt}`),n.join(" ")}async function Lt(e){var n;let t=new Headers;t.append("Content-Type","application/json"),t.append("x-goog-api-client",bt(e.requestOptions)),t.append("x-goog-api-key",e.apiKey);let s=(n=e.requestOptions)===null||n===void 0?void 0:n.customHeaders;if(s){if(!(s instanceof Headers))try{s=new Headers(s)}catch(i){throw new w(`unable to convert customHeaders value ${JSON.stringify(s)} to Headers: ${i.message}`)}for(let[i,o]of s.entries()){if(i==="x-goog-api-key")throw new w(`Cannot set reserved header name ${i}`);if(i==="x-goog-api-client")throw new w(`Header name ${i} can only be set using the apiClient field`);t.append(i,o)}}return t}async function Mt(e,n,t,s,i,o){let a=new oe(e,n,t,s,o);return{url:a.toString(),fetchOptions:Object.assign(Object.assign({},Ut(o)),{method:"POST",headers:await Lt(a),body:i})}}async function G(e,n,t,s,i,o={},a=fetch){let{url:r,fetchOptions:c}=await Mt(e,n,t,s,i,o);return xt(r,c,a)}async function xt(e,n,t=fetch){let s;try{s=await t(e,n)}catch(i){Dt(i,e)}return s.ok||await kt(s,e),s}function Dt(e,n){let t=e;throw e instanceof q||e instanceof w||(t=new y(`Error fetching from ${n.toString()}: ${e.message}`),t.stack=e.stack),t}async function kt(e,n){let t="",s;try{let i=await e.json();t=i.error.message,i.error.details&&(t+=` ${JSON.stringify(i.error.details)}`,s=i.error.details)}catch(i){}throw new q(`Error fetching from ${n.toString()}: [${e.status} ${e.statusText}] ${t}`,e.status,e.statusText,s)}function Ut(e){let n={};if((e==null?void 0:e.signal)!==void 0||(e==null?void 0:e.timeout)>=0){let t=new AbortController;(e==null?void 0:e.timeout)>=0&&setTimeout(()=>t.abort(),e.timeout),e!=null&&e.signal&&e.signal.addEventListener("abort",()=>{t.abort()}),n.signal=t.signal}return n}function re(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),Y(e.candidates[0]))throw new O(`${R(e)}`,e);return Ft(e)}else if(e.promptFeedback)throw new O(`Text not available. ${R(e)}`,e);return""},e.functionCall=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),Y(e.candidates[0]))throw new O(`${R(e)}`,e);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),De(e)[0]}else if(e.promptFeedback)throw new O(`Function call not available. ${R(e)}`,e)},e.functionCalls=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),Y(e.candidates[0]))throw new O(`${R(e)}`,e);return De(e)}else if(e.promptFeedback)throw new O(`Function call not available. ${R(e)}`,e)},e}function Ft(e){var n,t,s,i;let o=[];if(!((t=(n=e.candidates)===null||n===void 0?void 0:n[0].content)===null||t===void 0)&&t.parts)for(let a of(i=(s=e.candidates)===null||s===void 0?void 0:s[0].content)===null||i===void 0?void 0:i.parts)a.text&&o.push(a.text),a.executableCode&&o.push("\n```"+a.executableCode.language+`
`+a.executableCode.code+"\n```\n"),a.codeExecutionResult&&o.push("\n```\n"+a.codeExecutionResult.output+"\n```\n");return o.length>0?o.join(""):""}function De(e){var n,t,s,i;let o=[];if(!((t=(n=e.candidates)===null||n===void 0?void 0:n[0].content)===null||t===void 0)&&t.parts)for(let a of(i=(s=e.candidates)===null||s===void 0?void 0:s[0].content)===null||i===void 0?void 0:i.parts)a.functionCall&&o.push(a.functionCall);if(o.length>0)return o}var Pt=[F.RECITATION,F.SAFETY,F.LANGUAGE];function Y(e){return!!e.finishReason&&Pt.includes(e.finishReason)}function R(e){var n,t,s;let i="";if((!e.candidates||e.candidates.length===0)&&e.promptFeedback)i+="Response was blocked",!((n=e.promptFeedback)===null||n===void 0)&&n.blockReason&&(i+=` due to ${e.promptFeedback.blockReason}`),!((t=e.promptFeedback)===null||t===void 0)&&t.blockReasonMessage&&(i+=`: ${e.promptFeedback.blockReasonMessage}`);else if(!((s=e.candidates)===null||s===void 0)&&s[0]){let o=e.candidates[0];Y(o)&&(i+=`Candidate was blocked due to ${o.finishReason}`,o.finishMessage&&(i+=`: ${o.finishMessage}`))}return i}function P(e){return this instanceof P?(this.v=e,this):new P(e)}function $t(e,n,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=t.apply(e,n||[]),i,o=[];return i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i;function a(d){s[d]&&(i[d]=function(l){return new Promise(function(f,v){o.push([d,l,f,v])>1||r(d,l)})})}function r(d,l){try{c(s[d](l))}catch(f){m(o[0][3],f)}}function c(d){d.value instanceof P?Promise.resolve(d.value.v).then(h,p):m(o[0][2],d)}function h(d){r("next",d)}function p(d){r("throw",d)}function m(d,l){d(l),o.shift(),o.length&&r(o[0][0],o[0][1])}}var ke=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function Gt(e){let n=e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),t=jt(n),[s,i]=t.tee();return{stream:Ht(s),response:Kt(i)}}async function Kt(e){let n=[],t=e.getReader();for(;;){let{done:s,value:i}=await t.read();if(s)return re(Bt(n));n.push(i)}}function Ht(e){return $t(this,arguments,function*(){let t=e.getReader();for(;;){let{value:s,done:i}=yield P(t.read());if(i)break;yield yield P(re(s))}})}function jt(e){let n=e.getReader();return new ReadableStream({start(s){let i="";return o();function o(){return n.read().then(({value:a,done:r})=>{if(r){if(i.trim()){s.error(new y("Failed to parse stream"));return}s.close();return}i+=a;let c=i.match(ke),h;for(;c;){try{h=JSON.parse(c[1])}catch(p){s.error(new y(`Error parsing JSON response: "${c[1]}"`));return}s.enqueue(h),i=i.substring(c[0].length),c=i.match(ke)}return o()})}}})}function Bt(e){let n=e[e.length-1],t={promptFeedback:n==null?void 0:n.promptFeedback};for(let s of e){if(s.candidates)for(let i of s.candidates){let o=i.index;if(t.candidates||(t.candidates=[]),t.candidates[o]||(t.candidates[o]={index:i.index}),t.candidates[o].citationMetadata=i.citationMetadata,t.candidates[o].groundingMetadata=i.groundingMetadata,t.candidates[o].finishReason=i.finishReason,t.candidates[o].finishMessage=i.finishMessage,t.candidates[o].safetyRatings=i.safetyRatings,i.content&&i.content.parts){t.candidates[o].content||(t.candidates[o].content={role:i.content.role||"user",parts:[]});let a={};for(let r of i.content.parts)r.text&&(a.text=r.text),r.functionCall&&(a.functionCall=r.functionCall),r.executableCode&&(a.executableCode=r.executableCode),r.codeExecutionResult&&(a.codeExecutionResult=r.codeExecutionResult),Object.keys(a).length===0&&(a.text=""),t.candidates[o].content.parts.push(a)}}s.usageMetadata&&(t.usageMetadata=s.usageMetadata)}return t}async function $e(e,n,t,s){let i=await G(n,N.STREAM_GENERATE_CONTENT,e,!0,JSON.stringify(t),s);return Gt(i)}async function Ge(e,n,t,s){let o=await(await G(n,N.GENERATE_CONTENT,e,!1,JSON.stringify(t),s)).json();return{response:re(o)}}function Ke(e){if(e!=null){if(typeof e=="string")return{role:"system",parts:[{text:e}]};if(e.text)return{role:"system",parts:[e]};if(e.parts)return e.role?e:{role:"system",parts:e.parts}}}function $(e){let n=[];if(typeof e=="string")n=[{text:e}];else for(let t of e)typeof t=="string"?n.push({text:t}):n.push(t);return Yt(n)}function Yt(e){let n={role:"user",parts:[]},t={role:"function",parts:[]},s=!1,i=!1;for(let o of e)"functionResponse"in o?(t.parts.push(o),i=!0):(n.parts.push(o),s=!0);if(s&&i)throw new y("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!s&&!i)throw new y("No content is provided for sending chat message.");return s?n:t}function qt(e,n){var t;let s={model:n==null?void 0:n.model,generationConfig:n==null?void 0:n.generationConfig,safetySettings:n==null?void 0:n.safetySettings,tools:n==null?void 0:n.tools,toolConfig:n==null?void 0:n.toolConfig,systemInstruction:n==null?void 0:n.systemInstruction,cachedContent:(t=n==null?void 0:n.cachedContent)===null||t===void 0?void 0:t.name,contents:[]},i=e.generateContentRequest!=null;if(e.contents){if(i)throw new w("CountTokensRequest must have one of contents or generateContentRequest, not both.");s.contents=e.contents}else if(i)s=Object.assign(Object.assign({},s),e.generateContentRequest);else{let o=$(e);s.contents=[o]}return{generateContentRequest:s}}function Ue(e){let n;return e.contents?n=e:n={contents:[$(e)]},e.systemInstruction&&(n.systemInstruction=Ke(e.systemInstruction)),n}function Vt(e){return typeof e=="string"||Array.isArray(e)?{content:$(e)}:e}var Fe=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],Jt={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function zt(e){let n=!1;for(let t of e){let{role:s,parts:i}=t;if(!n&&s!=="user")throw new y(`First content should be with role 'user', got ${s}`);if(!Re.includes(s))throw new y(`Each item should include role field. Got ${s} but valid roles are: ${JSON.stringify(Re)}`);if(!Array.isArray(i))throw new y("Content should have 'parts' property with an array of Parts");if(i.length===0)throw new y("Each Content should have at least one part");let o={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(let r of i)for(let c of Fe)c in r&&(o[c]+=1);let a=Jt[s];for(let r of Fe)if(!a.includes(r)&&o[r]>0)throw new y(`Content with role '${s}' can't contain '${r}' part`);n=!0}}var Pe="SILENT_ERROR",ae=class{constructor(n,t,s,i={}){this.model=t,this.params=s,this._requestOptions=i,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=n,s!=null&&s.history&&(zt(s.history),this._history=s.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(n,t={}){var s,i,o,a,r,c;await this._sendPromise;let h=$(n),p={safetySettings:(s=this.params)===null||s===void 0?void 0:s.safetySettings,generationConfig:(i=this.params)===null||i===void 0?void 0:i.generationConfig,tools:(o=this.params)===null||o===void 0?void 0:o.tools,toolConfig:(a=this.params)===null||a===void 0?void 0:a.toolConfig,systemInstruction:(r=this.params)===null||r===void 0?void 0:r.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,h]},m=Object.assign(Object.assign({},this._requestOptions),t),d;return this._sendPromise=this._sendPromise.then(()=>Ge(this._apiKey,this.model,p,m)).then(l=>{var f;if(l.response.candidates&&l.response.candidates.length>0){this._history.push(h);let v=Object.assign({parts:[],role:"model"},(f=l.response.candidates)===null||f===void 0?void 0:f[0].content);this._history.push(v)}else{let v=R(l.response);v&&console.warn(`sendMessage() was unsuccessful. ${v}. Inspect response object for details.`)}d=l}),await this._sendPromise,d}async sendMessageStream(n,t={}){var s,i,o,a,r,c;await this._sendPromise;let h=$(n),p={safetySettings:(s=this.params)===null||s===void 0?void 0:s.safetySettings,generationConfig:(i=this.params)===null||i===void 0?void 0:i.generationConfig,tools:(o=this.params)===null||o===void 0?void 0:o.tools,toolConfig:(a=this.params)===null||a===void 0?void 0:a.toolConfig,systemInstruction:(r=this.params)===null||r===void 0?void 0:r.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,h]},m=Object.assign(Object.assign({},this._requestOptions),t),d=$e(this._apiKey,this.model,p,m);return this._sendPromise=this._sendPromise.then(()=>d).catch(l=>{throw new Error(Pe)}).then(l=>l.response).then(l=>{if(l.candidates&&l.candidates.length>0){this._history.push(h);let f=Object.assign({},l.candidates[0].content);f.role||(f.role="model"),this._history.push(f)}else{let f=R(l);f&&console.warn(`sendMessageStream() was unsuccessful. ${f}. Inspect response object for details.`)}}).catch(l=>{l.message!==Pe&&console.error(l)}),d}};async function Wt(e,n,t,s){return(await G(n,N.COUNT_TOKENS,e,!1,JSON.stringify(t),s)).json()}async function Xt(e,n,t,s){return(await G(n,N.EMBED_CONTENT,e,!1,JSON.stringify(t),s)).json()}async function Qt(e,n,t,s){let i=t.requests.map(a=>Object.assign(Object.assign({},a),{model:n}));return(await G(n,N.BATCH_EMBED_CONTENTS,e,!1,JSON.stringify({requests:i}),s)).json()}var V=class{constructor(n,t,s={}){this.apiKey=n,this._requestOptions=s,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=Ke(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(n,t={}){var s;let i=Ue(n),o=Object.assign(Object.assign({},this._requestOptions),t);return Ge(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(s=this.cachedContent)===null||s===void 0?void 0:s.name},i),o)}async generateContentStream(n,t={}){var s;let i=Ue(n),o=Object.assign(Object.assign({},this._requestOptions),t);return $e(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(s=this.cachedContent)===null||s===void 0?void 0:s.name},i),o)}startChat(n){var t;return new ae(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(t=this.cachedContent)===null||t===void 0?void 0:t.name},n),this._requestOptions)}async countTokens(n,t={}){let s=qt(n,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),i=Object.assign(Object.assign({},this._requestOptions),t);return Wt(this.apiKey,this.model,s,i)}async embedContent(n,t={}){let s=Vt(n),i=Object.assign(Object.assign({},this._requestOptions),t);return Xt(this.apiKey,this.model,s,i)}async batchEmbedContents(n,t={}){let s=Object.assign(Object.assign({},this._requestOptions),t);return Qt(this.apiKey,this.model,n,s)}};var J=class{constructor(n){this.apiKey=n}getGenerativeModel(n,t){if(!n.model)throw new y("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new V(this.apiKey,n,t)}getGenerativeModelFromCachedContent(n,t,s){if(!n.name)throw new w("Cached content must contain a `name` field.");if(!n.model)throw new w("Cached content must contain a `model` field.");let i=["model","systemInstruction"];for(let a of i)if(t!=null&&t[a]&&n[a]&&(t==null?void 0:t[a])!==n[a]){if(a==="model"){let r=t.model.startsWith("models/")?t.model.replace("models/",""):t.model,c=n.model.startsWith("models/")?n.model.replace("models/",""):n.model;if(r===c)continue}throw new w(`Different value for "${a}" specified in modelParams (${t[a]}) and cachedContent (${n[a]})`)}let o=Object.assign(Object.assign({},t),{model:n.model,tools:n.tools,toolConfig:n.toolConfig,systemInstruction:n.systemInstruction,cachedContent:n});return new V(this.apiKey,o,s)}};var z=class{constructor(n){this.config=n;this.genAI=new J(n.apiKey)}async generateContent(n,t){return{content:(await this.genAI.getGenerativeModel({model:"gemini-1.5-flash"}).generateContent(`${n}
${t}`)).response.text(),status:200}}async checkConfig(){try{return await this.generateContent("test","test"),!0}catch(n){return!1}}};var He=require("obsidian"),W=class{constructor(n){this.config=n}async generateContent(n,t){let s=(this.config.baseUrl||"https://api.deepseek.com")+"/v1/chat/completions",i=await(0,He.requestUrl)({url:s,method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.apiKey}`},body:JSON.stringify({model:this.config.model||"deepseek-reasoner",messages:[{role:"system",content:n},{role:"user",content:t}]})});return{content:i.json.choices[0].message.content,status:i.status}}async checkConfig(){try{return await this.generateContent("test","test"),!0}catch(n){return!1}}};var b=class{static createLLM(n,t){switch(n){case"openai":return new B(t);case"gemini":return new z(t);case"deepseek":return new W(t);default:throw new Error(`Unknown LLM type: ${n}`)}}};var Zt="You are a professional English translator...",en={language:"Chinese",tone:"informal"},tn=(e={})=>{let n={...en,...e};return`You are a science and technology author who is proficient in Chinese and English. 
    Please help me rewrite this article in ${n.language}.
    I hope anyone can read it easily, and the tone should be ${n.tone}.
    
    Take care to maintain the technical details and logical structure of the original text, while taking into account the differences in expression habits between Chinese and English. In the process of transcription, please pay special attention to the following matters:
    - Linguistic accuracy: Ensure accurate translation of scientific and technical terms and avoid ambiguity.
    - Cultural differences: Adjust the expressions to make them more in line with the cultural background of the target readers.
    - Technical details: Provide necessary background information or explanations for complex technical content.
    - Structure and formatting: Maintain the logical structure of the original text and ensure that the transcribed text is well organized.
    - SEO Optimization: Consider SEO factors during the transcription process and use appropriate keywords and phrases.
    - Copyright and citation: Respect the copyright of the original article by citing the source and original author.

    Output the following
    ### "Title":"Title is a SEO friendly Title. ",
    ### "Subtitle":"Subtitle is a short description of the article.",
    ### "Summany":"Summany is a summary of the article. No more than 200 characters",
    ### "BlogContent":"BlogContent is the main content of the article."
    `};async function je(e,n){let t=b.createLLM(e.settings.llmType,Q(e));return t?(await t.generateContent(Zt,n)).content:(new ce.Notice("LLM provider not found!"),"")}var X=class{constructor(n){this.llmProvider=n}async GenerateRewrite(n,t){let s=tn(t);try{let i=await this.llmProvider.generateContent(s,n);if(i.status!==200)throw new Error(`Request failed with status: ${i.status}`);return i.content}catch(i){throw console.error("GenerateRewrite error:",i),i}}};async function Be(e,n){let t=b.createLLM(e.settings.llmType,Q(e));return t?(await t.generateContent(e.settings.customPrompt+` 
 check the input content's language, return the same language.only return the summary.
 The content is: 
 `,n)).content:(new ce.Notice("LLM provider not found!"),"")}function Q(e){switch(e.settings.llmType){case"openai":return{apiKey:e.settings.opanAiApiKey,baseUrl:e.settings.baseUrl,model:e.settings.openAiModel[0]};case"gemini":return{apiKey:"",baseUrl:"",model:""};case"deepseek":return{apiKey:e.settings.deepSeekApiKey,baseUrl:e.settings.deepSeekApiUrl,model:e.settings.deepSeekModel[0]};default:return{apiKey:"",baseUrl:"",model:""}}}var nn={llmType:"openai",devToApiKey:"",baseUrl:"",opanAiApiKey:"",openAiModel:["gpt-4o-mini"],customPrompt:"Please summarize the following article into a paragraph of no more than 150 words, highlighting the main points and making it concise and easy to understand.",geminiApiKey:"",ghostUrl:"",ghostApiKey:"",deepSeekApiKey:"",deepSeekApiUrl:"",deepSeekModel:[]},sn=e=>`
---

- [\u672C\u6587\u957F\u671F\u94FE\u63A5](${e})
- \u5982\u679C\u60A8\u89C9\u5F97\u6211\u7684\u535A\u5BA2\u5BF9\u4F60\u6709\u5E2E\u52A9\uFF0C\u8BF7\u901A\u8FC7 [RSS](https://huizhou92.com/index.xml)\u8BA2\u9605\u6211\u3002
- \u6216\u8005\u5728[X](https://x.com/@piaopiaopig)\u4E0A\u5173\u6CE8\u6211\u3002
- \u5982\u679C\u60A8\u6709[Medium](https://medium.huizhou92.com/)\u8D26\u53F7\uFF0C\u80FD\u7ED9\u6211\u4E2A\u5173\u6CE8\u561B\uFF1F\u6211\u7684\u6587\u7AE0\u7B2C\u4E00\u65F6\u95F4\u90FD\u4F1A\u53D1\u5E03\u5728Medium\u3002`,on=e=>`
---

- [Long Time Link](${e})
- If you find my blog helpful, please subscribe to me via [RSS](https://huizhou92.com/index.xml)
- Or follow me on [X](https://x.com/@piaopiaopig)
- If you have a [Medium](https://medium.huizhou92.com/) account, follow me there. My articles will be published there as soon as possible.`;async function le(e,n){let t=this.app.workspace.getActiveViewOfType(g.MarkdownView);if(!t){new g.Notice("No active markdown view");return}t.editor.setValue(n)}async function de(){let e=this.app.workspace.getActiveViewOfType(g.MarkdownView);return e?e.editor.getValue():(new g.Notice("No active markdown view"),null)}async function an(e,n){let t=/^---\n([\s\S]*?)\n---/,s=`---
${(0,g.stringifyYaml)(n)}---`;return e.replace(t,s)}var Z=class extends g.Plugin{async onload(){await this.loadSettings();let t=b.createLLM(this.settings.llmType,Q(this)),s=new X(t);this.addSettingTab(new j(this.app,this)),this.addCommand({id:"summary by openai",name:"Generate Summary",callback:()=>this.addSummany()}),this.addCommand({id:"translate by Ai",name:"translate by Ai",callback:()=>this.translateByAi()}),this.addCommand({id:"rewrite by Ai",name:"rewrite by Ai",callback:async()=>{var p;let i=this.app.workspace.getActiveViewOfType(g.MarkdownView);if(!i){new g.Notice("No active markdown view");return}if(!i.file){new g.Notice("No active file"),console.log("No active file");return}let o=i.file.path.includes("zh-cn"),a=i.editor.getValue(),r,c,h=((p=i.file.parent)==null?void 0:p.path)||"";o?(c=`${h}/${i.file.basename.replace("zh-cn","")}.md`,r=await s.GenerateRewrite(a,{language:"English",tone:"formal"})):(c=`${h}/${i.file.basename}.zh-cn.md`,r=await s.GenerateRewrite(a,{language:"Chinese",tone:"formal"})),await this.createNewFile(c,r)}}),this.addCommand({id:"generate-slug",name:"Generate Slug",callback:async()=>{var p;let i=this.app.workspace.getActiveViewOfType(g.MarkdownView);if(!i){new g.Notice("No active markdown view");return}if(!i.file){new g.Notice("No active file"),console.log("No active file");return}let o=i.file.path.includes("zh-cn"),a=this.app.metadataCache.getFileCache(i.file),r=(p=a==null?void 0:a.frontmatter)==null?void 0:p.title;var c="";let h=await this.generateSlug(r);if(a&&a.frontmatter){let m=a.frontmatter;o?(h=encodeURIComponent(h),m.slug=h,m.long_time_url=`https://www.huizhou92.com/zh-cn/p/${h}/`,c=sn(`https://huizhou92.com/zh-cn/p/${h}/`)):(m.slug=h,m.long_time_url=`https://www.huizhou92.com/p/${h}/`,c=on(`https://huizhou92.com/p/${h}/`));let l=`${i.editor.getValue()}
${c}`;i.editor.setValue(l);let f=/^---\n([\s\S]*?)\n---/,v=`---
${(0,g.stringifyYaml)(m)}---`;i.editor.setValue(l.replace(f,v))}else new g.Notice("Metadata or frontmatter is null or undefined")}}),this.addCommand({id:"increase-heading-level",name:"Increase Heading Level",callback:()=>this.changeHeadingLevel(1)}),this.addCommand({id:"decrease-heading-level",name:"Decrease Heading Level",callback:()=>this.changeHeadingLevel(-1)})}onunload(){}async generateSlug(t){return t.toLowerCase().replace(/[\s]+/g,"-").replace(/[^\w\u4e00-\u9fa5\-]/g,"").replace(/-+/g,"-")}async createNewFile(t,s){try{await this.app.vault.create(t,s||"")}catch(i){console.error("\u521B\u5EFA\u6587\u4EF6\u5931\u8D25:",i)}}async translateByAi(){var c;let t=this.app.workspace.getActiveFile();if(!t)return;let s=t.basename,i=`${t.basename}.zh-cn.md`;this.app.fileManager.renameFile(t,i);let a=`${((c=t.parent)==null?void 0:c.path)||""}/${s}`,r=await this.readLoaclFile();await this.createNewFile(a,r)}async getFileContent(){let t=await de.call(this);return t?t.replace(/^---\n([\s\S]*?)\n---\n/,""):""}async readLoaclFile(){let t=await this.getFileContent();return t?await je(this,t):(new g.Notice("\u6CA1\u6709\u5185\u5BB9"),"")}async addSummany(){let t=await de.call(this);if(!t)return;let s=await Be(this,t);if(!s){new g.Notice("No summary generated!");return}let i=JSON.parse(s),o=/^---\n([\s\S]*?)\n---/,a=t.match(o);if(a){let r=(0,g.parseYaml)(a[1])||{};r.description=i.description,r.social=i.social;let c=await an(t,r);await le.call(this,this.app.workspace.getActiveFile(),c)}else{let r=`---
description: ${i.description}
social:${i.social}
 ---
${t}`;await le.call(this,this.app.workspace.getActiveFile(),r)}new g.Notice("Summany Generated!")}async changeHeadingLevel(t){let s=await de.call(this);if(!s)return;let o=s.split(`
`).map(a=>{var r,c,h;if(a.startsWith("#")){let p=(h=(c=(r=a.match(/^#+/))==null?void 0:r[0])==null?void 0:c.length)!=null?h:0;return t>0&&p>=6||t<0&&p<=1?a:t>0?"#"+a:a.substring(1)}return a});await le.call(this,this.app.workspace.getActiveFile(),o.join(`
`)),new g.Notice("Heading levels updated!")}async loadSettings(){this.settings=Object.assign({},nn,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}};
/*! Bundled license information:

@google/generative-ai/dist/index.js:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
*/
